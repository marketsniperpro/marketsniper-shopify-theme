<!DOCTYPE html>
<html lang="{{ request.locale.iso_code }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>
    {{ page_title }}
    {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
    {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
    {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
  </title>

  {% if page_description %}
    <meta name="description" content="{{ page_description | escape }}">
  {% endif %}

  <link rel="canonical" href="{{ canonical_url }}">

  <meta property="og:site_name" content="{{ shop.name }}">
  <meta property="og:url" content="{{ canonical_url }}">
  <meta property="og:title" content="{{ page_title | default: shop.name }}">
  <meta property="og:type" content="website">
  <meta property="og:description" content="{{ page_description | default: shop.description | escape }}">

  <link rel="icon" type="image/jpg" href="{{ 'logo.jpg' | asset_url }}">

  {{ content_for_header }}

  <!-- CSS Files -->
  <link rel="stylesheet" href="{{ 'reset.css' | asset_url }}">
  <link rel="stylesheet" href="{{ 'theme.css' | asset_url }}">
  <link rel="stylesheet" href="{{ 'animations.css' | asset_url }}?v=4">
</head>
<body class="template-{{ template.name | handle }}">

  <main id="MainContent" role="main">
    {{ content_for_layout }}
  </main>

  <!-- JavaScript Files -->
  <script src="{{ 'utils.js' | asset_url }}" defer></script>
  <script src="{{ 'animations.js' | asset_url }}" defer></script>
  <script src="{{ 'main.js' | asset_url }}" defer></script>

<!-- App Authentication Integration -->
  <script>
  (function() {
    // Check if user is logged in to the app
    fetch('https://app.marketsniper.pro/api/auth/status', {
      credentials: 'include',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(res => res.json())
    .then(data => {
      console.log('Auth data:', data); // Debug - check what's being returned
      
      if (data.authenticated) {
        // Use firstName, or fallback to truncated email
        let displayName = data.firstName || 'Account';
        
        // Replace desktop login button
        const loginBtn = document.querySelector('.login-btn');
        if (loginBtn) {
          const userLink = document.createElement('a');
          userLink.href = 'https://app.marketsniper.pro/portal';
          userLink.className = 'account-icon';
          userLink.style.cssText = 'display: flex; align-items: center; gap: 8px; padding: 8px 12px; border: 1px solid #CECECE; border-radius: 6px; text-decoration: none; transition: all 0.2s ease;';
          userLink.innerHTML = `
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#CECECE" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span style="color: #CECECE; font-weight: 500;">${displayName}</span>
          `;
          
          // Hover effect
          userLink.addEventListener('mouseenter', function() {
            this.style.borderColor = '#00ff41';
            this.querySelector('svg').style.stroke = '#00ff41';
            this.querySelector('span').style.color = '#00ff41';
          });
          userLink.addEventListener('mouseleave', function() {
            this.style.borderColor = '#CECECE';
            this.querySelector('svg').style.stroke = '#CECECE';
            this.querySelector('span').style.color = '#CECECE';
          });
          
          loginBtn.replaceWith(userLink);
        }
        
        // Replace mobile login button
        const mobileLogin = document.querySelector('.mobile-login');
        if (mobileLogin) {
          const mobileUserLink = document.createElement('a');
          mobileUserLink.href = 'https://app.marketsniper.pro/portal';
          mobileUserLink.className = 'mobile-account';
          mobileUserLink.innerHTML = `
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>${displayName}'s Portal</span>
          `;
          mobileLogin.replaceWith(mobileUserLink);
        }
      }
    })
    .catch(err => {
      console.log('Auth check:', err);
    });
  })();
  </script>

  <style>
  /* Hover effect for account icon */
  .account-icon:hover svg {
    stroke: #00ff41;
    transition: stroke 0.2s ease;
  }
  </style>
  
  <style>
  /* Hover effect for user avatar */
  .account-icon:hover div {
    transform: scale(1.05);
    transition: transform 0.2s ease;
  }
  </style>

</body>
</html>